<!DOCTYPE html>
<html>
<head>
	<meta name="deepview-service" content="deepview-service">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:700,300" rel="stylesheet" type="text/css">
	<style>
		body {
			margin: 0;
			word-wrap: break-word;
			background-color: #ffffff;
		}
	</style>
	<script>
		// Function to retrieve the referring link
		function getReferringLink() {
		  const referringLink = document.referrer;
		  return referringLink;
		}

		// Function to make the API request to Branch to load data behind the Branch link
		async function getBranchLinkData(branchLink) {
		  const url = `https://api2.branch.io/v1/url?url=${encodeURIComponent(branchLink)}&branch_key=key_live_opbTjnZIc7Ci2hT1wJasclfkwtmMlnIu`;

		  try {
		    const response = await fetch(url, {
		      method: 'GET',
		      headers: {
		        'accept': 'application/json'
		      }
		    });

		    if (!response.ok) {
		      throw new Error(`Error fetching Branch link data: ${response.statusText}`);
		    }

		    const data = await response.json();
		    createNewBranchLink(data);
		  } catch (error) {
		    console.error('Failed to retrieve Branch link data:', error);
		  }
		}

		// Function to create a new Branch link based on incoming link data
		async function createNewBranchLink(linkData) {
		  const url = 'https://api2.branch.io/v1/url';
		  const requestData = {
		    data: linkData.data,
		    branch_key: 'key_live_opbTjnZIc7Ci2hT1wJasclfkwtmMlnIu'
		  };

		  try {
		    const response = await fetch(url, {
		      method: 'POST',
		      headers: {
		        'accept': 'application/json',
		        'content-type': 'application/json'
		      },
		      body: JSON.stringify(requestData)
		    });

		    if (!response.ok) {
		      throw new Error(`Error creating new Branch link: ${response.statusText}`);
		    }

		    const newLinkData = await response.json();
		    console.log('New Branch link created:', newLinkData);
		    // Redirect to the new link
		    window.location.href = newLinkData.url || 'placeholder-action-url';
		  } catch (error) {
		    console.error('Failed to create new Branch link:', error);
		  }
		}

		// Example usage
		(async () => {
		  const referringLink = getReferringLink();
		  if (referringLink) {
		    await getBranchLinkData(referringLink);
		  } else {
		    console.log('No referring link found.');
		  }
		})();
	</script>
</head>
<body>
</body>
</html>
